<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dictionary Game - Multiplayer</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='90'>ðŸ“š</text></svg>">

    <!-- DNS Prefetch for external APIs (early DNS resolution) -->
    <link rel="dns-prefetch" href="https://api.dictionaryapi.dev">
    <link rel="dns-prefetch" href="https://api.datamuse.com">
    <link rel="dns-prefetch" href="https://api.qrserver.com">

    <!-- Preconnect to critical external domains (DNS + TCP + TLS) -->
    <link rel="preconnect" href="https://www.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

    <!-- Preload only critical resources needed immediately -->
    <link rel="preload" href="dist/output.css?v=1.4.6" as="style">
    <link rel="preload" href="dist/app.js?v=1.4.6" as="script">

    <!-- Tailwind CSS - Compiled (includes all custom styles) -->
    <link rel="stylesheet" href="dist/output.css?v=1.4.6">

    <!-- Firebase - defer to avoid blocking render -->
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <!-- React - defer to avoid blocking render -->
    <script defer crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script defer crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
</head>
<body>
    <main id="root"></main>

    <!-- Vercel Speed Insights - Lazy loaded after page interactive -->
    <script type="module">
        // Defer Speed Insights until page is fully interactive
        if (document.readyState === 'complete') {
            loadSpeedInsights();
        } else {
            window.addEventListener('load', () => {
                setTimeout(loadSpeedInsights, 3000); // Load 3s after page load
            });
        }

        function loadSpeedInsights() {
            import('https://cdn.jsdelivr.net/npm/@vercel/speed-insights@1/dist/index.mjs')
                .then(({ injectSpeedInsights }) => injectSpeedInsights())
                .catch(err => console.warn('Speed Insights failed to load:', err));
        }
    </script>

    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('[App] Service Worker registered:', registration.scope);

                        // Check for updates periodically
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            console.log('[App] New Service Worker found, installing...');

                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    console.log('[App] New version available! Refresh to update.');
                                    // Optionally show a toast notification here
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('[App] Service Worker registration failed:', error);
                    });
            });
        }
    </script>

    <script defer src="dist/app.js?v=1.4.6"></script>
</body>
</html>
